<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Sílvia de Castro - Portfolio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Correcció per a Safari -->
    <script>
        // Detecta Safari (excloent Chrome i altres navegadors basats en Chromium)
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

        if (isSafari) {
            window.addEventListener('load', () => {
                // Força Safari a recalcular el layout del flexbox després del render inicial
                const track = document.getElementById('marqueeTrack');
                if (track) track.style.display = 'flex'; // Simplement re-aplica flex
            });
        }
    </script>

</head>

<body>

    <!-- HEADER -->
    <div id="header"></div>

    <!-- MENÚ -->
    <div id="navbar">
        <a href="#about" onclick="openNav()">About</a>
    </div>

    <script>
        var prevScrollpos = window.pageYOffset;
        window.onscroll = function() {
            var currentScrollPos = window.pageYOffset;
            if (prevScrollpos > currentScrollPos) {
                document.getElementById("navbar").style.transform = "translateY(0)";
            } else {
                document.getElementById("navbar").style.transform = "translateY(-100%)";
            }
            prevScrollpos = currentScrollPos;
        };
    </script>

    <!-- ABOUT desplegable -->
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <div id="about">
            <h3>Sílvia de Castro, 1993
            <br>sdecastro11@gmail.com</h3>
            
            <h3>Habilidades</h3>
            <ul>
                <li>Animación y 3D ⸻ After Effects, Cinema 4D, Sketchup</li>
                <li>Diseño Gáfico ⸻ Photoshop, Illustrator, Indesign</li>
                <li>Diseño Web ⸻ Figma</li>
            </ul>

            <h3>Experiencia</h3>
            <ul>
                <li>2021/act. ⸻ Diseñadora gráfica en NOMON</li>
                <li>2025 ⸻ Participación en la Comissión Evaluadora de TFG, ESDAPC</li>
                <li>2020/2021 ⸻ Diseñadora gráfica en prácticas en Run</li>
                <li>2017/2019 ⸻ Fotogrametría con drones y técnico de calidad en SITEP</li>
            </ul>

            <h3>Formación</h3>
            <ul>
                <li>2024 ⸻ Curso de Midjourney</li>
                <li>2019/2020 ⸻ Máster en Diseño Gráfico, ELISAVA</li>
                <li>2018 ⸻ Curso de Serigrafía, Centre cívic Pati Llimona</li>
                <li>2018 ⸻ Curso Técnico Superior en Diseño Gráfico y Maquetación, Seeway</li>
                <li>2015/2016 ⸻ Máster en Teledetección y Sistemas de Información Geográfica, UAB</li>
                <li>2011/2015 ⸻ Grado en Ciencias Ambientales, UB</li>
            </ul>

            <h3>Premios
            <br>ADG Laus Estudiantes 2021 ⸻ Proyecto inplant (Bronce)</h3>
        </div>
    </div>

    <script>
        function openNav() {
            document.getElementById("mySidenav").classList.add("open");
        }

        function closeNav() {
            document.getElementById("mySidenav").classList.remove("open");
        }
    </script>

    <!-- ========================= -->
    <!--   CARRUSEL (DESKTOP)      -->
    <!-- ========================= -->

    <script>
        // Si és mòbil, no inicialitzem el carrusel
        const isMobile = window.innerWidth <= 768;
    </script>



    <div class="marquee-wrap" id="marqueeWrap">
        <div class="marquee-track" id="marqueeTrack">

            <div class="marquee-item" data-h="50vh">
                <video autoplay muted loop playsinline>
                    <source src="images/enhormigon01.mp4" type="video/mp4">
                </video>
                <div class="caption">Design of EN HORMIGÓN magazine. For ETSAM.</div>
            </div>

            <div class="marquee-item" data-h="80vh">
                <video autoplay muted loop playsinline>
                    <source src="images/enhormigon02.mp4" type="video/mp4">
                </video>
                <div class="caption">Design of EN HORMIGÓN magazine. For ETSAM.</div>
            </div>

            <div class="marquee-item" data-h="50vh">
                <video autoplay muted loop playsinline>
                    <source src="images/COSMIC_Branding_Final.mp4" type="video/mp4">
                </video>
                <div class="caption">Animation for COSMIC. Made at NOMON.</div>
            </div>

            <div class="marquee-item" data-h="40vh">
                <video autoplay muted loop playsinline>
                    <source src="images/COSMIC_blanc.mp4" type="video/mp4">
                </video>
                <div class="caption">COSMIC Booth Design. Made at NOMON.</div>
            </div>

            <div class="marquee-item" data-h="40vh">
                <video autoplay muted loop playsinline>
                    <source src="images/MESCLADIS_branding.mp4" type="video/mp4">
                </video>
                <div class="caption">Animation for Mescladís. Made at NOMON.</div>
            </div>

            <div class="marquee-item" data-h="30vh">
                <video autoplay muted loop playsinline>
                    <source src="images/inplant01.mp4" type="video/mp4">
                </video>
                <div class="caption">Master's Degree Project. ELISAVA.</div>
            </div>

            <div class="marquee-item" data-h="48vh">
                <video autoplay muted loop playsinline>
                    <source src="images/Athos_story.mp4" type="video/mp4">
                </video>
                <div class="caption">Animation of Instagram posts for Athos. Made at NOMON.</div>
            </div>

            <div class="marquee-item" data-h="50vh">
                <video autoplay muted loop playsinline>
                    <source src="images/drymelt.mp4" type="video/mp4">
                </video>
                <div class="caption">Branding and packaging for DryMelt (UIC). Made at NOMON.</div>
            </div>

            <div class="marquee-item" data-h="43vh">
                <video autoplay muted loop playsinline>
                    <source src="images/Athos_posts.mp4" type="video/mp4">
                </video>
                <div class="caption">Design and animation of Instagram posts for Athos. Made at NOMON.</div>
            </div>

            <div class="marquee-item" data-h="35vh">
                <video autoplay muted loop playsinline>
                    <source src="images/BSDW.mp4" type="video/mp4">
                </video>
                <div class="caption">Animation for BSDW. Made at NOMON.</div>
            </div>

        </div>
    </div>

    <!-- ========================= -->
    <!--   GALERIA MÒBIL VERTICAL  -->
    <!-- ========================= -->
    <div class="mobile-gallery"></div>

    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true">
        <img id="lightboxImg" src="" alt="Zoom">
    </div>

    <!-- JS DEL CARRUSEL (es manté igual) -->
    <script>
        (function() {
            const wrap = document.getElementById('marqueeWrap');
            const track = document.getElementById('marqueeTrack');
            let speed = Number(getComputedStyle(document.documentElement).getPropertyValue('--speed')) || 25;
            let raf = null,
                lastTime = null,
                offset = 0;
            let isDragging = false,
                startX = 0,
                dragStartOffset = 0;
            let startY = 0; // Per al control tàctil
            let scrollDirection = null; // 'horizontal', 'vertical', o null
            let clone = null;
            
            function applyHeights() {
                const wrapMaxPx = window.innerHeight * 0.8;
                Array.from(track.children).forEach(it => {
                    const h = it.dataset.h;
                    if (!h) return;
                    let px;
                    if (/vh$/.test(h)) px = window.innerHeight * parseFloat(h) / 100;
                    else if (/px$/.test(h)) px = parseFloat(h);
                    else px = parseFloat(h);
                    it.style.height = Math.min(px, wrapMaxPx) + 'px';
                });
            }

            function createClone() {
                if (clone && clone.parentNode) {
                    clone.remove();
                }

                clone = track.cloneNode(true);
                clone.removeAttribute("id");

                clone.style.position = "absolute";
                clone.style.top = "0";
                clone.style.display = "flex";
                clone.style.gap = getComputedStyle(track).gap;

                repositionClone(); // Llama a la función que ahora contiene la lógica de posicionamiento

                track.parentNode.appendChild(clone);
            }

            function repositionClone() {
                if (!clone) return;
                let w = track.scrollWidth;
                // En Safari, scrollWidth pot no incloure el gap, l'afegim manualment.
                if (isSafari) {
                    const gapValue = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap'), 10) || 0;
                    w += gapValue;
                }
                clone.style.left = w + "px";
            }

            function update(dt) {
                if (!isDragging) offset += speed * dt / 1000;

                const w = track.scrollWidth;
                offset = ((offset % w) + w) % w;

                track.style.transform = `translateX(${-offset}px)`;
                clone.style.transform = `translateX(${-offset}px)`;
                repositionClone(); // Usamos la función para asegurar que la posición del clon es siempre correcta
            }

            function loop(ts) {
                if (!lastTime) lastTime = ts;
                const dt = ts - lastTime;
                lastTime = ts;
                update(dt);
                raf = requestAnimationFrame(loop);
            }

            function start() {
                cancelAnimationFrame(raf);
                lastTime = null;
                raf = requestAnimationFrame(loop);
            }

            // Drag
            function onDragStart(x, y) {
                isDragging = true;
                startX = x;
                startY = y;
                dragStartOffset = offset;
                scrollDirection = null; // Reseteja la direcció a cada inici
            }

            function onDragMove(x) {
                if (!isDragging) return;
                const w = track.scrollWidth;
                const dx = x - startX;
                offset = ((dragStartOffset - dx) % w + w) % w;
            }

            function onDragEnd() {
                isDragging = false;
            }

            wrap.addEventListener('mousedown', e => onDragStart(e.clientX));
            wrap.addEventListener('mousemove', e => {
                if (isDragging) onDragMove(e.clientX);
            });
            wrap.addEventListener('mouseup', onDragEnd);
            wrap.addEventListener('mouseleave', onDragEnd);
            wrap.addEventListener('touchstart', e => onDragStart(e.touches[0].clientX, e.touches[0].clientY), { passive: true });
            wrap.addEventListener('touchmove', e => {
                if (!isDragging) return;

                const dx = Math.abs(e.touches[0].clientX - startX);
                const dy = Math.abs(e.touches[0].clientY - startY);

                if (scrollDirection === null) {
                    if (dx > 10 && dx > dy) scrollDirection = 'horizontal';
                    else if (dy > 10 && dy > dx) scrollDirection = 'vertical';
                }
                if (scrollDirection === 'horizontal') {
                    e.preventDefault();
                    onDragMove(e.touches[0].clientX);
                }
            }, {
                passive: false
            });

            wrap.addEventListener('touchend', onDragEnd);

            function init() {
                applyHeights();
                createClone();
                start();
            }


            if (!isMobile) init();


            // Reajustar
            setTimeout(() => {
                applyHeights();
                repositionClone();
            }, 800);

            window.addEventListener('resize', () => {
                applyHeights();
                repositionClone();
            });

        })();
    </script>

    <!-- ======================== -->
    <!-- JS PER GENERAR GALERIA MOBILE -->
    <!-- ======================== -->
    <script>
        function buildMobileGallery() {
            const track = document.getElementById("marqueeTrack");
            const mobile = document.querySelector(".mobile-gallery");

            if (!track || !mobile) return;

            Array.from(track.children).forEach(item => {
                const clone = item.cloneNode(true);
                clone.style.height = "auto";
                mobile.appendChild(clone);
            });
        }

        if (window.innerWidth <= 768) {
            buildMobileGallery();
        }
    </script>

</body>

</html>